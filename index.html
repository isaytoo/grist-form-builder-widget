<!--
  Grist Form Builder Pro Widget
  Copyright 2026 Said Hamadou (isaytoo)
  Licensed under the Apache License, Version 2.0
  https://github.com/isaytoo/grist-form-builder-widget
-->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form Builder Pro - Widget Grist</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: #f1f5f9; color: #334155; height: 100vh; overflow: hidden; }
    .app-container { display: flex; flex-direction: column; height: 100vh; }
    .header { background: white; border-bottom: 1px solid #e2e8f0; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
    .header-left { display: flex; align-items: center; gap: 15px; }
    .header h1 { font-size: 1.1em; font-weight: 600; color: #1e293b; }
    .mode-toggle { display: flex; background: #f1f5f9; border-radius: 8px; padding: 3px; }
    .mode-btn { padding: 6px 14px; border: none; background: transparent; font-size: 0.8em; font-weight: 500; color: #64748b; cursor: pointer; border-radius: 6px; transition: all 0.2s; }
    .mode-btn.active { background: white; color: #3b82f6; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .header-actions { display: flex; gap: 8px; }
    .btn { padding: 7px 14px; border: none; border-radius: 6px; font-size: 0.8em; font-weight: 500; cursor: pointer; transition: all 0.15s; display: flex; align-items: center; gap: 5px; }
    .btn-primary { background: #3b82f6; color: white; }
    .btn-primary:hover { background: #2563eb; }
    .btn-success { background: #10b981; color: white; }
    .btn-success:hover { background: #059669; }
    .btn-secondary { background: #e2e8f0; color: #475569; }
    .btn-secondary:hover { background: #cbd5e1; }
    .btn-warning { background: #f59e0b; color: white; }
    .btn-warning:hover { background: #d97706; }
    .main-content { display: flex; flex: 1; overflow: hidden; }
    .sidebar { width: 260px; background: white; border-right: 1px solid #e2e8f0; display: flex; flex-direction: column; flex-shrink: 0; position: relative; transition: width 0.3s, margin 0.3s; }
    .sidebar.collapsed { width: 0; border-right: none; }
    .sidebar.collapsed > *:not(.panel-toggle) { display: none; }
    .panel-toggle { position: absolute; top: 50%; width: 20px; height: 40px; background: white; border: 1px solid #e2e8f0; border-radius: 0 6px 6px 0; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 20; transition: all 0.3s; }
    .panel-toggle:hover { background: #f1f5f9; }
    .panel-toggle svg { width: 12px; height: 12px; fill: #64748b; transition: transform 0.3s; }
    .sidebar .panel-toggle { right: -20px; transform: translateY(-50%); }
    .sidebar.collapsed .panel-toggle svg { transform: rotate(180deg); }
    .sidebar-header { padding: 12px; border-bottom: 1px solid #e2e8f0; }
    .sidebar-title { font-size: 0.75em; font-weight: 600; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
    .table-select { width: 100%; padding: 7px 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.85em; font-family: inherit; }
    .sidebar-tabs { display: flex; border-bottom: 1px solid #e2e8f0; }
    .sidebar-tab { flex: 1; padding: 10px; border: none; background: transparent; font-size: 0.8em; font-weight: 500; color: #64748b; cursor: pointer; transition: all 0.15s; }
    .sidebar-tab.active { color: #3b82f6; border-bottom: 2px solid #3b82f6; margin-bottom: -1px; }
    .sidebar-content { flex: 1; overflow-y: auto; padding: 10px; }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }
    .field-item, .element-item { padding: 8px 10px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; margin-bottom: 5px; cursor: grab; transition: all 0.15s; display: flex; align-items: center; gap: 8px; font-size: 0.85em; }
    .field-item:hover, .element-item:hover { border-color: #3b82f6; background: #eff6ff; }
    .field-item.dragging, .element-item.dragging { opacity: 0.5; }
    .field-icon { font-size: 1em; width: 18px; text-align: center; }
    .field-name { flex: 1; font-weight: 500; color: #334155; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .field-type { font-size: 0.7em; color: #94a3b8; background: #f1f5f9; padding: 2px 5px; border-radius: 3px; }
    .elements-category { margin-bottom: 12px; }
    .elements-category-title { font-size: 0.7em; font-weight: 600; color: #94a3b8; text-transform: uppercase; margin-bottom: 6px; padding-left: 2px; }
    .workspace { flex: 1; padding: 0; overflow: auto; background: #e2e8f0; position: relative; display: flex; flex-direction: column; }
    .workspace-inner { display: flex; justify-content: center; min-width: fit-content; padding: 20px 50px 50px 50px; flex: 1; }
    .workspace-toolbar { position: sticky; top: 0; left: 0; right: 0; background: white; padding: 8px 15px; display: flex; gap: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); z-index: 20; justify-content: center; flex-shrink: 0; border-bottom: 1px solid #e2e8f0; width: 100%; }
    .toolbar-btn { padding: 5px 10px; border: 1px solid #e2e8f0; background: white; border-radius: 4px; font-size: 0.8em; cursor: pointer; transition: all 0.15s; }
    .toolbar-btn:hover { background: #f1f5f9; }
    .toolbar-btn.active { background: #3b82f6; color: white; border-color: #3b82f6; }
    .toolbar-separator { width: 1px; background: #e2e8f0; margin: 0 4px; }
    .page-a4 { width: 210mm; min-height: 297mm; background: white; box-shadow: 0 4px 20px rgba(0,0,0,0.15); position: relative; padding: 15mm; background-size: 20px 20px; box-sizing: border-box; overflow: visible; flex-shrink: 0; }
    .page-a4.show-grid { background-image: linear-gradient(to right, #f1f5f9 1px, transparent 1px), linear-gradient(to bottom, #f1f5f9 1px, transparent 1px); }
    .workspace-with-rulers { position: relative; }
    .ruler { background: #f8fafc; position: absolute; z-index: 10; }
    .ruler-h { top: 50px; left: 0; height: 20px; border-bottom: 1px solid #e2e8f0; display: none; width: calc(100% + 300px); }
    .ruler-v { top: 70px; left: 0; width: 30px; min-height: calc(297mm + 50px); border-right: 1px solid #e2e8f0; display: none; }
    .ruler.show { display: block; }
    .ruler-marks { position: relative; height: 100%; width: 100%; }
    .ruler-h .ruler-mark { position: absolute; top: 0; height: 100%; border-left: 1px solid #cbd5e1; font-size: 9px; color: #64748b; padding-left: 2px; }
    .ruler-v .ruler-mark { position: absolute; left: 0; width: 100%; border-top: 1px solid #cbd5e1; font-size: 9px; color: #64748b; writing-mode: vertical-rl; text-orientation: mixed; padding-top: 2px; }
    .ruler-corner { position: absolute; top: 0; left: 0; width: 30px; height: 20px; background: #f8fafc; border-right: 1px solid #e2e8f0; border-bottom: 1px solid #e2e8f0; z-index: 11; display: none; }
    .ruler-corner.show { display: block; }
    .workspace.with-rulers .page-a4 { margin-top: 25px; margin-left: 35px; }
    .page-a4.drag-over { outline: 2px dashed #3b82f6; outline-offset: -5px; }
    .form-field { position: absolute; background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 10px; min-width: 180px; cursor: move; transition: box-shadow 0.15s; }
    .form-field:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .form-field.selected { border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); }
    .form-field-label { font-size: 0.8em; font-weight: 500; color: #475569; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; }
    .form-field-input { width: 100%; padding: 7px 9px; border: 1px solid #e2e8f0; border-radius: 4px; font-size: 0.85em; font-family: inherit; background: #f8fafc; }
    .form-field-textarea { min-height: 60px; resize: none; }
    .form-field-delete { position: absolute; top: -8px; right: -8px; width: 18px; height: 18px; background: #ef4444; color: white; border: none; border-radius: 50%; font-size: 11px; cursor: pointer; display: none; align-items: center; justify-content: center; line-height: 1; }
    .form-field:hover .form-field-delete { display: flex; }
    .form-field-resize { position: absolute; bottom: 0; right: 0; width: 12px; height: 12px; cursor: se-resize; opacity: 0; }
    .form-field:hover .form-field-resize { opacity: 1; }
    .form-field-resize::after { content: ''; position: absolute; bottom: 3px; right: 3px; width: 6px; height: 6px; border-right: 2px solid #94a3b8; border-bottom: 2px solid #94a3b8; }
    .form-section { position: absolute; background: #f8fafc; border: 2px dashed #cbd5e1; border-radius: 8px; min-width: 200px; min-height: 100px; cursor: move; }
    .form-section.selected { border-color: #3b82f6; }
    .form-section-title { padding: 8px 12px; font-size: 0.85em; font-weight: 600; color: #475569; background: white; border-bottom: 1px dashed #cbd5e1; border-radius: 6px 6px 0 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .form-section-delete { position: absolute; top: -8px; right: -8px; width: 18px; height: 18px; background: #ef4444; color: white; border: none; border-radius: 50%; font-size: 11px; cursor: pointer; display: none; align-items: center; justify-content: center; }
    .form-section:hover .form-section-delete { display: flex; }
    .form-section .form-field-resize { position: absolute; bottom: 0; right: 0; width: 12px; height: 12px; cursor: se-resize; opacity: 0; }
    .form-section:hover .form-field-resize { opacity: 1; }
    .form-section .form-field-resize::after { content: ''; position: absolute; bottom: 3px; right: 3px; width: 6px; height: 6px; border-right: 2px solid #94a3b8; border-bottom: 2px solid #94a3b8; }
    .signature-pad { border: 1px solid #e2e8f0; border-radius: 4px; background: #fafafa; height: 80px; display: flex; align-items: center; justify-content: center; color: #94a3b8; font-size: 0.8em; }
    .options-preview { display: flex; flex-direction: column; gap: 4px; }
    .option-item { display: flex; align-items: center; gap: 6px; font-size: 0.8em; color: #64748b; }
    .properties-panel { width: 280px; background: white; border-left: 1px solid #e2e8f0; display: flex; flex-direction: column; flex-shrink: 0; position: relative; transition: width 0.3s; }
    .properties-panel.collapsed { width: 0; border-left: none; }
    .properties-panel.collapsed > *:not(.panel-toggle) { display: none; }
    .properties-panel .panel-toggle { left: -20px; transform: translateY(-50%); border-radius: 6px 0 0 6px; }
    .properties-panel.collapsed .panel-toggle svg { transform: rotate(180deg); }
    .properties-header { padding: 12px 15px; border-bottom: 1px solid #e2e8f0; font-size: 0.85em; font-weight: 600; color: #1e293b; }
    .properties-content { flex: 1; overflow-y: auto; padding: 12px; }
    .property-group { margin-bottom: 14px; }
    .property-label { font-size: 0.75em; font-weight: 500; color: #64748b; margin-bottom: 4px; }
    .property-input { width: 100%; padding: 7px 9px; border: 1px solid #e2e8f0; border-radius: 5px; font-size: 0.85em; font-family: inherit; }
    .property-input:focus { outline: none; border-color: #3b82f6; }
    .property-select { width: 100%; padding: 7px 9px; border: 1px solid #e2e8f0; border-radius: 5px; font-size: 0.85em; font-family: inherit; background: white; }
    .property-checkbox { display: flex; align-items: center; gap: 8px; font-size: 0.85em; }
    .property-checkbox input { width: 16px; height: 16px; }
    .options-editor { border: 1px solid #e2e8f0; border-radius: 5px; padding: 8px; background: #f8fafc; }
    .option-row { display: flex; gap: 6px; margin-bottom: 5px; }
    .option-row input { flex: 1; padding: 5px 8px; border: 1px solid #e2e8f0; border-radius: 4px; font-size: 0.8em; }
    .option-row button { padding: 5px 8px; border: none; background: #ef4444; color: white; border-radius: 4px; cursor: pointer; font-size: 0.75em; }
    .add-option-btn { width: 100%; padding: 6px; border: 1px dashed #cbd5e1; background: white; border-radius: 4px; font-size: 0.8em; color: #64748b; cursor: pointer; margin-top: 5px; }
    .add-option-btn:hover { border-color: #3b82f6; color: #3b82f6; }
    .form-view { display: none; height: 100%; overflow-y: auto; }
    .form-view.active { display: block; }
    .editor-view { display: flex; }
    .editor-view.hidden { display: none; }
    .form-container { max-width: 700px; margin: 0 auto; padding: 30px; }
    .form-canvas-view { position: relative; width: 210mm; min-height: 297mm; background: white; margin: 0 auto; box-shadow: 0 4px 20px rgba(0,0,0,0.1); box-sizing: border-box; overflow: visible; }
    .form-field-view { position: absolute; background: white; }
    .form-field-view .form-label { margin-bottom: 4px; }
    .form-field-view .form-input, .form-field-view .form-select, .form-field-view .form-textarea-input { padding: 8px 10px; font-size: 0.9em; }
    .form-image { position: absolute; background: white; border: 1px solid #e2e8f0; border-radius: 6px; overflow: visible; cursor: move; }
    .form-image img { width: 100%; height: 100%; object-fit: contain; }
    .form-image-placeholder { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #f8fafc; color: #94a3b8; font-size: 2em; }
    .form-image-delete { position: absolute; top: -8px; right: -8px; width: 18px; height: 18px; background: #ef4444; color: white; border: none; border-radius: 50%; font-size: 11px; cursor: pointer; display: none; align-items: center; justify-content: center; }
    .form-image:hover .form-image-delete { display: flex; }
    .form-image .form-field-resize { position: absolute; bottom: 0; right: 0; width: 12px; height: 12px; cursor: se-resize; opacity: 0; }
    .form-image:hover .form-field-resize { opacity: 1; }
    .form-image .form-field-resize::after { content: ''; position: absolute; bottom: 3px; right: 3px; width: 6px; height: 6px; border-right: 2px solid #94a3b8; border-bottom: 2px solid #94a3b8; }
    .form-image.selected { border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); }
    .form-title-element { position: absolute; background: transparent; cursor: move; font-size: 1.2em; font-weight: 600; color: #1e293b; padding: 5px; min-height: 30px; }
    .form-title-element.selected { outline: 2px solid #3b82f6; }
    .form-title-element-delete { position: absolute; top: -8px; right: -8px; width: 18px; height: 18px; background: #ef4444; color: white; border: none; border-radius: 50%; font-size: 11px; cursor: pointer; display: none; align-items: center; justify-content: center; }
    .form-title-element:hover .form-title-element-delete { display: flex; }
    .form-title-element .resize-handle { position: absolute; bottom: 0; right: 0; width: 14px; height: 14px; cursor: se-resize; opacity: 0; transition: opacity 0.15s; }
    .form-title-element .resize-handle::after { content: ''; position: absolute; bottom: 3px; right: 3px; width: 6px; height: 6px; border-right: 2px solid #94a3b8; border-bottom: 2px solid #94a3b8; }
    .form-title-element:hover .resize-handle, .form-title-element.selected .resize-handle { opacity: 1; }
    .form-qrcode { position: absolute; background: white; border: 1px solid #e2e8f0; border-radius: 6px; padding: 8px; cursor: move; }
    .form-qrcode.selected { border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); }
    .form-qrcode-delete { position: absolute; top: -8px; right: -8px; width: 18px; height: 18px; background: #ef4444; color: white; border: none; border-radius: 50%; font-size: 11px; cursor: pointer; display: none; align-items: center; justify-content: center; }
    .form-qrcode:hover .form-qrcode-delete { display: flex; }
    .form-qrcode canvas, .form-qrcode img { display: block; }
    .form-actions-fixed { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: white; padding: 15px 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); display: flex; gap: 12px; justify-content: center; z-index: 100; }
    .form-title { font-size: 1.3em; font-weight: 600; color: #1e293b; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #e2e8f0; }
    .form-section-view { position: absolute; padding: 15px; background: #f8fafc; border-radius: 8px; border: 1px dashed #cbd5e1; box-sizing: border-box; }
    .form-section-view-title { font-size: 0.9em; font-weight: 600; color: #334155; margin-bottom: 10px; }
    .form-group { margin-bottom: 18px; }
    .form-group.hidden { display: none; }
    .form-label { display: block; font-size: 0.9em; font-weight: 500; color: #475569; margin-bottom: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .form-label.required::after { content: ' *'; color: #ef4444; }
    .form-input, .form-select, .form-textarea-input { width: 100%; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.95em; font-family: inherit; transition: border-color 0.15s; }
    .form-input:focus, .form-select:focus, .form-textarea-input:focus { outline: none; border-color: #3b82f6; }
    .form-textarea-input { min-height: 100px; resize: vertical; }
    .form-radio-group, .form-checkbox-group { display: flex; flex-direction: column; gap: 8px; }
    .form-radio-item, .form-checkbox-item { display: flex; align-items: center; gap: 8px; font-size: 0.9em; }
    .form-radio-item input, .form-checkbox-item input { width: 18px; height: 18px; }
    .signature-canvas-container { border: 1px solid #e2e8f0; border-radius: 6px; background: white; position: relative; }
    .signature-canvas { width: 100%; height: 120px; cursor: crosshair; }
    .signature-clear { position: absolute; top: 5px; right: 5px; padding: 4px 8px; font-size: 0.75em; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 4px; cursor: pointer; }
    .form-actions { margin-top: 30px; display: flex; gap: 12px; }
    .form-error { color: #ef4444; font-size: 0.8em; margin-top: 4px; }
    .empty-message { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #94a3b8; }
    .empty-message-icon { font-size: 3em; margin-bottom: 15px; }
    .empty-message-text { font-size: 0.9em; }
    .toast { position: fixed; bottom: 20px; right: 20px; padding: 12px 20px; background: #1e293b; color: white; border-radius: 8px; font-size: 0.9em; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transform: translateY(100px); opacity: 0; transition: all 0.3s; z-index: 1000; }
    .toast.show { transform: translateY(0); opacity: 1; }
    .toast.success { background: #10b981; }
    .toast.error { background: #ef4444; }
    .loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.9); display: flex; align-items: center; justify-content: center; z-index: 999; }
    .loading-overlay.hidden { display: none; }
    .loading-spinner { width: 40px; height: 40px; border: 3px solid #e2e8f0; border-top-color: #3b82f6; border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; }
    .modal-overlay.hidden { display: none; }
    .modal { background: white; border-radius: 12px; padding: 25px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; }
    .modal-title { font-size: 1.1em; font-weight: 600; margin-bottom: 20px; color: #1e293b; }
    .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
    .confirm-modal { text-align: center; }
    .confirm-modal-icon { font-size: 3em; margin-bottom: 15px; }
    .confirm-modal-title { font-size: 1.1em; font-weight: 600; color: #1e293b; margin-bottom: 10px; }
    .confirm-modal-message { font-size: 0.9em; color: #64748b; margin-bottom: 20px; }
    .confirm-modal-actions { display: flex; gap: 10px; justify-content: center; }
    .btn-cancel { background: #f1f5f9; color: #475569; }
    .btn-cancel:hover { background: #e2e8f0; }
    .btn-confirm { background: #3b82f6; color: white; }
    .btn-confirm:hover { background: #2563eb; }
    .btn-confirm.danger { background: #ef4444; }
    .btn-confirm.danger:hover { background: #dc2626; }
    .templates-list { max-height: 300px; overflow-y: auto; }
    .template-item { padding: 12px; border: 1px solid #e2e8f0; border-radius: 6px; margin-bottom: 8px; cursor: pointer; transition: all 0.15s; }
    .template-item:hover { border-color: #3b82f6; background: #eff6ff; }
    .template-name { font-weight: 500; color: #334155; }
    .template-date { font-size: 0.8em; color: #94a3b8; margin-top: 4px; }
  </style>
</head>
<body>
<div class="app-container">
  <div class="header">
    <div class="header-left">
      <h1>ğŸ“ Form Builder Pro</h1>
      <div class="mode-toggle">
        <button class="mode-btn active" id="btn-mode-edit">âœï¸ Ã‰dition</button>
        <button class="mode-btn" id="btn-mode-fill">ğŸ“‹ Saisie</button>
        <button class="mode-btn" id="btn-mode-guide">ğŸ“– Guide</button>
      </div>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" id="btn-templates">ğŸ“ Templates</button>
      <button class="btn btn-success" id="btn-share-form" title="Partager le formulaire">ğŸ”— Partager</button>
      <button class="btn btn-warning" id="btn-export-pdf">ğŸ“„ PDF</button>
      <button class="btn btn-secondary" id="btn-clear">ğŸ—‘ï¸ Vider</button>
      <button class="btn btn-primary" id="btn-save">ğŸ’¾ Sauvegarder</button>
    </div>
  </div>
  
  <div class="main-content editor-view" id="editor-view">
    <div class="sidebar" id="sidebar">
      <button class="panel-toggle" id="sidebar-toggle" title="Fermer/Ouvrir">
        <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
      </button>
      <div class="sidebar-header">
        <div class="sidebar-title">Titre du formulaire</div>
        <input type="text" class="table-select" id="form-title-input" placeholder="Mon formulaire" value="">
        <div class="sidebar-title" style="margin-top: 10px;">Table source</div>
        <select class="table-select" id="table-select">
          <option value="">Chargement...</option>
        </select>
      </div>
      <div class="sidebar-tabs">
        <button class="sidebar-tab active" data-tab="fields">Champs</button>
        <button class="sidebar-tab" data-tab="elements">Ã‰lÃ©ments</button>
      </div>
      <div class="sidebar-content">
        <div class="tab-panel active" id="tab-fields">
          <div id="fields-list"></div>
        </div>
        <div class="tab-panel" id="tab-elements">
          <div class="elements-category">
            <div class="elements-category-title">Champs de saisie</div>
            <div class="element-item" draggable="true" data-element-type="text"><span class="field-icon">ğŸ“</span><span class="field-name">Texte court</span></div>
            <div class="element-item" draggable="true" data-element-type="textarea"><span class="field-icon">ğŸ“„</span><span class="field-name">Texte long</span></div>
            <div class="element-item" draggable="true" data-element-type="number"><span class="field-icon">ğŸ”¢</span><span class="field-name">Nombre</span></div>
            <div class="element-item" draggable="true" data-element-type="date"><span class="field-icon">ğŸ“…</span><span class="field-name">Date</span></div>
            <div class="element-item" draggable="true" data-element-type="email"><span class="field-icon">ğŸ“§</span><span class="field-name">Email</span></div>
            <div class="element-item" draggable="true" data-element-type="phone"><span class="field-icon">ğŸ“</span><span class="field-name">TÃ©lÃ©phone</span></div>
          </div>
          <div class="elements-category">
            <div class="elements-category-title">Choix</div>
            <div class="element-item" draggable="true" data-element-type="select"><span class="field-icon">ğŸ“‹</span><span class="field-name">Liste dÃ©roulante</span></div>
            <div class="element-item" draggable="true" data-element-type="radio"><span class="field-icon">ğŸ”˜</span><span class="field-name">Choix unique</span></div>
            <div class="element-item" draggable="true" data-element-type="checkbox"><span class="field-icon">â˜‘ï¸</span><span class="field-name">Cases Ã  cocher</span></div>
          </div>
          <div class="elements-category">
            <div class="elements-category-title">SpÃ©ciaux</div>
            <div class="element-item" draggable="true" data-element-type="signature"><span class="field-icon">âœï¸</span><span class="field-name">Signature</span></div>
            <div class="element-item" draggable="true" data-element-type="section"><span class="field-icon">ğŸ“¦</span><span class="field-name">Section</span></div>
            <div class="element-item" draggable="true" data-element-type="image"><span class="field-icon">ğŸ–¼ï¸</span><span class="field-name">Image</span></div>
            <div class="element-item" draggable="true" data-element-type="title"><span class="field-icon">ğŸ·ï¸</span><span class="field-name">Titre/Texte</span></div>
            <div class="element-item" draggable="true" data-element-type="qrcode"><span class="field-icon">ğŸ“±</span><span class="field-name">QR Code</span></div>
            <div class="element-item" draggable="true" data-element-type="lookup"><span class="field-icon">ğŸ”</span><span class="field-name">Lookup</span></div>
            <div class="element-item" draggable="true" data-element-type="calculated"><span class="field-icon">ğŸ§®</span><span class="field-name">Champ calculÃ©</span></div>
          </div>
        </div>
        </div>
    </div>
    
    <div class="workspace" id="workspace">
      <div class="workspace-toolbar">
        <button class="toolbar-btn" id="btn-grid" title="Grille">âŠ Grille</button>
        <button class="toolbar-btn" id="btn-snap" title="Snap">ğŸ§² Snap</button>
        <button class="toolbar-btn" id="btn-rulers" title="RÃ¨gles">ğŸ“ RÃ¨gles</button>
        <div class="toolbar-separator"></div>
        <button class="toolbar-btn" id="btn-zoom-out">âˆ’</button>
        <span id="zoom-level" style="font-size: 0.8em; padding: 0 8px; min-width: 45px; text-align: center; display: inline-block;">100%</span>
        <button class="toolbar-btn" id="btn-zoom-in">+</button>
        <button class="toolbar-btn" id="btn-zoom-fit" title="Ajuster Ã  l'Ã©cran">â›¶</button>
        <div class="toolbar-separator"></div>
        <button class="toolbar-btn" id="btn-prev-page" title="Page prÃ©cÃ©dente">â—€</button>
        <span id="page-indicator" style="font-size: 0.8em; padding: 0 8px; min-width: 60px; text-align: center; display: inline-block;">1 / 1</span>
        <button class="toolbar-btn" id="btn-next-page" title="Page suivante">â–¶</button>
        <button class="toolbar-btn" id="btn-add-page" title="Ajouter une page">+ Page</button>
      </div>
      <div class="ruler-corner" id="ruler-corner"></div>
      <div class="ruler ruler-h" id="ruler-h"><div class="ruler-marks" id="ruler-h-marks"></div></div>
      <div class="ruler ruler-v" id="ruler-v"><div class="ruler-marks" id="ruler-v-marks"></div></div>
      <div class="workspace-inner">
        <div class="page-a4 show-grid" id="form-canvas">
          <div class="empty-message" id="empty-message">
            <div class="empty-message-icon">ğŸ“„</div>
            <div class="empty-message-text">Glissez-dÃ©posez des champs ici<br>pour crÃ©er votre formulaire</div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="properties-panel" id="properties-panel">
      <button class="panel-toggle" id="properties-toggle" title="Fermer/Ouvrir">
        <svg viewBox="0 0 24 24"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>
      </button>
      <div class="properties-header">PropriÃ©tÃ©s</div>
      <div class="properties-content" id="properties-content">
        <p style="color: #94a3b8; font-size: 0.85em;">SÃ©lectionnez un champ</p>
      </div>
    </div>
  </div>
  
  <div class="form-view" id="form-view">
    <div style="padding: 40px 20px 50px 20px; background: #e2e8f0; min-height: 100%;">
      <div class="form-canvas-view" id="form-canvas-view">
        <div id="form-fields-view"></div>
      </div>
      <div class="form-actions-fixed">
        <button class="btn btn-success" id="btn-submit">âœ… Enregistrer</button>
        <button class="btn btn-secondary" id="btn-reset-form">â†º RÃ©initialiser</button>
      </div>
    </div>
  </div>
  
  <div class="form-view" id="guide-view">
    <div style="padding: 40px; background: #f1f5f9; min-height: 100%; overflow-y: auto;">
      <div style="max-width: 800px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); padding: 40px;">
        <h1 style="font-size: 1.8em; color: #1e293b; margin-bottom: 10px; display: flex; align-items: center; gap: 12px;">ğŸ“– Guide d'utilisation</h1>
        <p style="color: #64748b; margin-bottom: 30px; font-size: 1em;">Apprenez Ã  crÃ©er et partager des formulaires professionnels avec Form Builder Pro.</p>
        
        <div style="display: grid; gap: 25px;">
          <div style="background: #eff6ff; border-radius: 10px; padding: 20px; border-left: 4px solid #3b82f6;">
            <h3 style="font-size: 1.1em; color: #1e293b; margin-bottom: 12px;">ğŸ¯ PrÃ©sentation</h3>
            <p style="color: #475569; line-height: 1.7;">Form Builder Pro permet de crÃ©er des formulaires professionnels sur page A4 avec drag & drop, puis de les partager avec vos utilisateurs. Les donnÃ©es sont enregistrÃ©es directement dans vos tables Grist.</p>
          </div>
          
          <div style="background: #f0fdf4; border-radius: 10px; padding: 20px; border-left: 4px solid #10b981;">
            <h3 style="font-size: 1.1em; color: #1e293b; margin-bottom: 12px;">ğŸ“ CrÃ©er un formulaire</h3>
            <ol style="color: #475569; line-height: 2; padding-left: 20px; margin: 0;">
              <li>SÃ©lectionnez la <strong>table source</strong> dans le menu dÃ©roulant</li>
              <li>Glissez les <strong>champs</strong> de la table ou les <strong>Ã©lÃ©ments</strong> sur la page A4</li>
              <li>Positionnez et redimensionnez les champs avec la souris</li>
              <li>Cliquez sur un champ pour configurer ses propriÃ©tÃ©s</li>
              <li>Cliquez sur <strong>ğŸ’¾ Sauvegarder</strong> pour enregistrer</li>
            </ol>
          </div>
          
          <div style="background: #fef3c7; border-radius: 10px; padding: 20px; border-left: 4px solid #f59e0b;">
            <h3 style="font-size: 1.1em; color: #1e293b; margin-bottom: 12px;">ğŸ”— Partager le formulaire</h3>
            <ol style="color: #475569; line-height: 2; padding-left: 20px; margin: 0;">
              <li>Sauvegardez votre formulaire</li>
              <li>Cliquez sur <strong>ğŸ”— Partager</strong></li>
              <li>Copiez l'URL affichÃ©e dans la modale</li>
              <li>Dans Grist, ajoutez un <strong>nouveau widget personnalisÃ©</strong></li>
              <li>Collez l'URL et accordez <strong>l'accÃ¨s complet</strong></li>
            </ol>
            <p style="color: #92400e; margin-top: 12px; font-size: 0.9em;"><strong>ğŸ’¡ Astuce :</strong> Les utilisateurs ne verront que le mode saisie, sans accÃ¨s Ã  l'Ã©dition.</p>
          </div>
          
          <div style="background: #faf5ff; border-radius: 10px; padding: 20px; border-left: 4px solid #8b5cf6;">
            <h3 style="font-size: 1.1em; color: #1e293b; margin-bottom: 12px;">ğŸ‘¥ Plusieurs formulaires</h3>
            <p style="color: #475569; line-height: 1.7;">Chaque formulaire est liÃ© Ã  une table. L'URL de partage contient le paramÃ¨tre <code style="background:#e2e8f0;padding:2px 6px;border-radius:4px;">table=NomTable</code>.</p>
            <p style="color: #475569; margin-top: 10px;">Exemple : <code style="background:#e2e8f0;padding:4px 8px;border-radius:4px;font-size:0.85em;">...?mode=form&table=Clients</code></p>
          </div>
          
          <div style="background: #f8fafc; border-radius: 10px; padding: 20px; border: 1px solid #e2e8f0;">
            <h3 style="font-size: 1.1em; color: #1e293b; margin-bottom: 15px;">âš™ï¸ FonctionnalitÃ©s</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
              <div style="display: flex; align-items: center; gap: 8px; color: #475569;"><span>ğŸ“„</span> Multi-pages A4</div>
              <div style="display: flex; align-items: center; gap: 8px; color: #475569;"><span>ğŸ”€</span> Champs conditionnels</div>
              <div style="display: flex; align-items: center; gap: 8px; color: #475569;"><span>ğŸ§®</span> Champs calculÃ©s</div>
              <div style="display: flex; align-items: center; gap: 8px; color: #475569;"><span>ğŸ”</span> Lookup / AutocomplÃ©tion</div>
              <div style="display: flex; align-items: center; gap: 8px; color: #475569;"><span>âœï¸</span> Signature</div>
              <div style="display: flex; align-items: center; gap: 8px; color: #475569;"><span>âœ…</span> Validation avancÃ©e</div>
              <div style="display: flex; align-items: center; gap: 8px; color: #475569;"><span>ğŸ“</span> Templates</div>
              <div style="display: flex; align-items: center; gap: 8px; color: #475569;"><span>ğŸ“œ</span> Historique des versions</div>
              <div style="display: flex; align-items: center; gap: 8px; color: #475569;"><span>ğŸ“„</span> Export PDF</div>
              <div style="display: flex; align-items: center; gap: 8px; color: #475569;"><span>ğŸ“±</span> QR Code</div>
            </div>
          </div>
          
          <div style="text-align: center; padding: 20px; color: #64748b;">
            <p>Besoin d'aide ? Visitez <a href="https://gristup.fr" target="_blank" style="color: #3b82f6; font-weight: 500;">gristup.fr</a></p>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="toast" id="toast"></div>
  <div class="loading-overlay" id="loading"><div class="loading-spinner"></div></div>
  
  <div class="modal-overlay hidden" id="modal-confirm">
    <div class="modal confirm-modal">
      <div class="confirm-modal-icon" id="confirm-icon">âš ï¸</div>
      <div class="confirm-modal-title" id="confirm-title">Confirmation</div>
      <div class="confirm-modal-message" id="confirm-message">ÃŠtes-vous sÃ»r ?</div>
      <div class="confirm-modal-actions">
        <button class="btn btn-cancel" id="btn-confirm-cancel">Annuler</button>
        <button class="btn btn-confirm" id="btn-confirm-ok">Confirmer</button>
      </div>
    </div>
  </div>
  
  <div class="modal-overlay hidden" id="modal-share">
    <div class="modal" style="max-width: 500px;">
      <div class="modal-title">ğŸ”— Partager le formulaire</div>
      <div style="text-align: center; padding: 15px 0;">
        <div style="font-size: 3em; margin-bottom: 10px;">ğŸ‰</div>
        <p style="font-size: 1em; color: #1e293b; font-weight: 600; margin-bottom: 5px;">Votre formulaire est prÃªt Ã  Ãªtre partagÃ© !</p>
        <p style="font-size: 0.85em; color: #64748b; margin-bottom: 20px;">Suivez les Ã©tapes ci-dessous pour le mettre Ã  disposition de vos utilisateurs.</p>
      </div>
      
      <div style="background: #f8fafc; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
        <div style="font-weight: 600; color: #1e293b; margin-bottom: 10px; font-size: 0.9em;">ğŸ“‹ Ã‰tape 1 : Copiez le lien</div>
        <div style="display: flex; gap: 8px;">
          <input type="text" id="share-url" readonly style="flex: 1; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.8em; background: white; font-family: monospace;">
          <button class="btn btn-primary" id="btn-copy-url" style="padding: 10px 15px;">ğŸ“‹ Copier</button>
        </div>
      </div>
      
      <div style="background: #eff6ff; border-radius: 8px; padding: 15px; margin-bottom: 15px; border-left: 4px solid #3b82f6;">
        <div style="font-weight: 600; color: #1e293b; margin-bottom: 10px; font-size: 0.9em;">ğŸ”§ Ã‰tape 2 : Ajoutez le widget dans Grist</div>
        <ol style="font-size: 0.85em; color: #475569; padding-left: 18px; margin: 0; line-height: 1.8;">
          <li>Ouvrez votre document Grist</li>
          <li>Cliquez sur <strong>+ Ajouter un widget</strong></li>
          <li>Choisissez <strong>Widget personnalisÃ©</strong></li>
          <li>Collez l'URL copiÃ©e ci-dessus</li>
          <li>Dans le panneau de droite, accordez <strong>l'accÃ¨s complet</strong></li>
        </ol>
      </div>
      
      <div style="background: #fef3c7; border-radius: 8px; padding: 12px 15px; margin-bottom: 20px; border-left: 4px solid #f59e0b;">
        <div style="font-size: 0.85em; color: #92400e;">
          <strong>ğŸ’¡ Astuce :</strong> Les utilisateurs ne verront que le formulaire de saisie, sans accÃ¨s Ã  l'Ã©dition.
        </div>
      </div>
      
      <div class="modal-actions">
        <button class="btn btn-secondary" id="btn-close-share">Fermer</button>
      </div>
    </div>
  </div>
  
  <div class="modal-overlay hidden" id="modal-templates">
    <div class="modal">
      <div class="modal-title">ğŸ“ Templates</div>
      <div class="property-group">
        <div class="property-label">Nom du template</div>
        <input type="text" class="property-input" id="template-name" placeholder="Mon formulaire">
      </div>
      <button class="btn btn-primary" id="btn-save-template" style="width: 100%; margin-bottom: 20px;">ğŸ’¾ Sauvegarder</button>
      <div style="display: flex; gap: 10px; margin-bottom: 20px;">
        <button class="btn btn-secondary" id="btn-export-template" style="flex: 1;">ğŸ“¤ Exporter JSON</button>
        <button class="btn btn-secondary" id="btn-import-template" style="flex: 1;">ğŸ“¥ Importer JSON</button>
        <input type="file" id="import-file" accept=".json" style="display: none;">
      </div>
      <div style="display: flex; gap: 10px; margin-bottom: 10px;">
        <button class="btn btn-secondary" id="btn-show-templates" style="flex: 1; font-size: 0.8em;">ğŸ“ Templates</button>
        <button class="btn btn-secondary" id="btn-show-history" style="flex: 1; font-size: 0.8em;">ğŸ“œ Historique</button>
      </div>
      <div id="templates-tab">
        <div class="property-label">Templates enregistrÃ©s</div>
        <div class="templates-list" id="templates-list"><p style="color: #94a3b8; font-size: 0.85em; text-align: center; padding: 20px;">Aucun template</p></div>
      </div>
      <div id="history-tab" style="display: none;">
        <div class="property-label">Historique des versions</div>
        <div class="templates-list" id="history-list"><p style="color: #94a3b8; font-size: 0.85em; text-align: center; padding: 20px;">Aucun historique</p></div>
      </div>
      <div class="modal-actions"><button class="btn btn-secondary" id="btn-close-templates">Fermer</button></div>
    </div>
  </div>
</div>

<script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="widget.js"></script>
<footer style="position: fixed; bottom: 0; left: 0; right: 0; background: #f8fafc; border-top: 1px solid #e2e8f0; padding: 4px 12px; font-size: 0.7em; color: #94a3b8; display: flex; justify-content: space-between; z-index: 1000;">
  <span>Â© 2026 Said Hamadou (isaytoo)</span>
  <a href="https://gristup.fr" target="_blank" style="color: #3b82f6; text-decoration: none;">gristup.fr</a>
</footer>
</body>
</html>
